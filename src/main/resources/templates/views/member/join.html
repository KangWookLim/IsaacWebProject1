<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main_layout}">

<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/member/join.css}">
</th:block>

<div layout:fragment="content">

    <div class="member" style = "margin-top : 40px;">
        <!-- 로고 -->
        <h1>Sign In</h1>
        <div class="wrap" style = "margin-bottom : 30px;">
            <label class="form-label-mt-4"><b>ID</b></label>
            <input type="text" class="form-control" id="memId" name="memId">
            <button type = "button" class="btn btn-secondary" id="idChkBtn" style = "float : right; display : block;" onclick="userIdChk();">중복확인</button>
        </div>

        <div class="wrap">
            <label class="form-label-mt-4"><b>PW</b></label>
            <input type="password" class="form-control" id="memPasswd" name="memPasswd">
        </div>
        <div class="wrap">
            <label class="form-label-mt-4"><b>PW Confirm</b></label>
            <input type="password" class="form-control" id="memPasswdConfirm" name="memPasswdConfirm">
        </div>
        <div class="wrap">
            <label class="form-label-mt-4"><b>Nickname</b></label>
            <input type="text" class="form-control" id="memName" name="memName">
        </div>
        <div class="wrap">
            <label class="form-label-mt-4"><b>Birth</b></label>
            <input type="number" class="form-control" id="memBirth" name="memBirth" placeholder="6자리">
        </div>
        <div class="wrap">
            <label class="form-label-mt-4"><b>Gender</b></label>
            <select class="form-control" id="memGender" name="memGender">
                <option value="남자">Male</option>
                <option value="여자">Female</option>
            </select>
        </div>
        <div>
            <div class="wrap" id="email">
                <label class="form-label-mt-4"><b>E-mail</b></label>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <input type="text" class="form-control" id="mailId" name="mailId">
                </div>
                <div class="col-md-auto" style="padding-top: 5px">
                    <span style="font-weight: bold">@</span>
                </div>
                <div class="col-md-4">
                    <select id="mailAddr" name="mailAddr"
                            class="form-control" onchange="setEmailAddr(this.options[this.selectedIndex].value);">
                        <option value="none">선택해주세요</option>
                        <option value="naver.com">naver.com</option>
                        <option value="daum.net">daum.net</option>
                        <option value="gmail.com">gmail.com</option>
                        <option value="hotmail.com">hotmail.com</option>
                    </select>
                </div>
            </div>
        </div>
        <button class="btn btn-outline-secondary" type="button" id="button-addon2" style = "background : black; margin-right: 5px; float : right; width : 60px; position : relative" onclick="join()">Join</button>

    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css2?family=Blinker:wght@100;300&display=swap" rel="stylesheet">
<script>
    let isUserIdChk = false;

function userIdChk() {
    const memId = $('#memId').val();
    isUserIdChk = false;

    if($.trim(memId).length === 0) {
        alert('아이디를 입력하십시오.');
        return false;
    }

    $.ajax({
        url : '/mem/chk',
        type : 'get',
        dataType : 'json',
        data : 'json',
        data :{
            memId : memId
        }
    }).done(function (data){
        if(data.resultCode === 200) {
            alert('사용가능한 ID 입니다');
            isUserIdChk = true;

            $('#idChkBtn').prop('disabled', true);
        }else {
            alert('이미 등록된 ID 입니다.');
        }
    }).fail(function (xhr, status, error) {
        alert('시스템에 문제가 발생했습니다. 관리자에게 문의해주세요.');
        console.log(status);
    });
}

function validated () {
    const inputAll = document.querySelectorAll("input");
    let isValid = true;

    if(!isUserIdChk) {
        alert('아이디 중복체크를 실행해주세요');
        isValid = false;
        return false;
    }

    $.each(inputAll, function (index, obj) {
        const inputId = $(obj).attr('id');
        checkObj = $('#' + inputId);
        let message = '';

        if(inputId === 'memId') {
            message = "아이디를 입력하십시오.";
        }else if(inputId === 'memPasswd') {
            message = '패스워드를 입력하십시오';
        }else if(inputId === 'memPasswdConfirm') {
            message = '패스워드를 입력하십시오';
        }else if(inputId === 'memName') {
            message = "이름을 입력하십시오";
        }else if(inputId === 'memBirth') {
            message = "생년월일을 입력하십시오.";
        }else if(inputId === 'memPhone') {
            message = "전화번호를 입력하십시오.";
        }else if(inputId === 'mailId') {
            message = "메일주소를  입력하십시오.";
        }else if(inputId === "mailAddr") {
            message = "메일서비스 업체를 입력하십시오.";
        }else if(inputId === 'memSelCat') {
            message = "관심있는 애완동물 카테고리를 입력하십시오.";
        }
    });
        if( $('#memPasswd').val() !== $('#memPasswdConfirm').val()) {
            alert('비밀번호 확인이 일치하지 않습니다!');
            isValid = false;
            return false;
        }else if( $('#mailAddr').val() === 'none') {
            alert('메일서비스 업체를 입력하십시오.');
            isValid = false;
            return false;
        }


    return isValid;
}

function setEmailAddr(optionValue) {
    const mailAddr = $('#mailAddr');
    mailAddr.attr('readOnly', true);
    mailAddr.val('');

    if (optionValue !== "none") {
        mailAddr.val(optionValue);
        mailAddr.attr('readOnly', true);
    }
}

function join(){
    if(validated()) {
        $('#frm').submit();
    }
}

</script>
</html>